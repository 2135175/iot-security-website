import { ActionOrigin, EventActionType } from "@/hooks/useEvents";
import { APIEvent } from "node_modules/@solidjs/start/dist/server";
import { Event } from "@/hooks/useEvents";
import { pageSize } from "../page-size";

const events: Event[] = [
  {
    origin: ActionOrigin.MODULE,
    eventAction: EventActionType.ARM,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
  {
    origin: ActionOrigin.DASHBOARD,
    eventAction: EventActionType.UNLOCK,
    timestamp: 1717729222,
  },
];

export async function GET({ params }: APIEvent) {
  const pageNum = parseInt(params.page);
  if (params.sort !== "asc" && params.sort !== "des")
    return new Response(
      JSON.stringify({ message: "`sort` query param must be `asc` or `des`" }),
      { status: 400, statusText: "Bad request" }
    );
  if (pageNum < 1)
    return new Response(
      JSON.stringify({ message: "`page` number must be greater than 0" }),
      { status: 400, statusText: "Bad request" }
    );

  console.log(
    `Request to get page ${params.page} of event-logs sorted in ${params.sort} order`
  );

  let startIndex = (pageNum - 1) * pageSize;
  let endIndex = startIndex + pageSize;

  return await new Promise((resolve) =>
    setTimeout(
      () =>
        resolve({
          page: pageNum,
          pages: Math.ceil(events.length / pageSize),
          rows: events.length,
          events: events.slice(startIndex, endIndex),
        }),
      5000
    )
  );
}
